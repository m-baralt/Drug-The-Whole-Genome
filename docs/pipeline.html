<h1 id="drug-the-whole-genome-modified-fork">Drug-The-Whole-Genome
(Modified Fork)</h1>
<p>This is a modified version of <a
href="https://github.com/THU-ATOM/Drug-The-Whole-Genome">THU-ATOM/Drug-The-Whole-Genome</a>
with applied changes to the virtual screening DrugCLIP pipeline for
improved memory efficiency and PyTorch ≥ 2.6 compatibility. Please,
refer to the original repo for all the rest of functionalities
available.</p>
<p>This documentation mainly aims to understand the structure of
DrugCLIP and detail the modifications conducted for the virtual
screening.</p>
<h2 id="installation">Installation</h2>
<p>Installation instructions are available in the parent repository</p>
<h2 id="high-level-original-pipeline">High-level original pipeline</h2>
<div class="mxgraph"
style="max-width:100%;border:1px solid transparent;"
data-mxgraph="{&quot;highlight&quot;:&quot;#0000ff&quot;,&quot;nav&quot;:true,&quot;resize&quot;:true,&quot;dark-mode&quot;:&quot;auto&quot;,&quot;toolbar&quot;:&quot;zoom layers tags lightbox&quot;,&quot;edit&quot;:&quot;_blank&quot;,&quot;xml&quot;:&quot;&lt;mxfile host=\&quot;app.diagrams.net\&quot; agent=\&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/145.0.0.0 Safari/537.36\&quot; version=\&quot;29.5.2\&quot;&gt;\n  &lt;diagram name=\&quot;Página-1\&quot; id=\&quot;0CqOFQox0wAGSI3tT310\&quot;&gt;\n    &lt;mxGraphModel dx=\&quot;1426\&quot; dy=\&quot;816\&quot; grid=\&quot;1\&quot; gridSize=\&quot;10\&quot; guides=\&quot;1\&quot; tooltips=\&quot;1\&quot; connect=\&quot;1\&quot; arrows=\&quot;1\&quot; fold=\&quot;1\&quot; page=\&quot;1\&quot; pageScale=\&quot;1\&quot; pageWidth=\&quot;827\&quot; pageHeight=\&quot;1169\&quot; math=\&quot;0\&quot; shadow=\&quot;0\&quot;&gt;\n      &lt;root&gt;\n        &lt;mxCell id=\&quot;0\&quot; /&gt;\n        &lt;mxCell id=\&quot;1\&quot; parent=\&quot;0\&quot; /&gt;\n        &lt;mxCell id=\&quot;9lEqP-Ao-6W_A4MsMKyB-3\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;9lEqP-Ao-6W_A4MsMKyB-1\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;\&quot; target=\&quot;9lEqP-Ao-6W_A4MsMKyB-2\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;UserObject label=\&quot;retrieval.sh\&quot; link=\&quot;#retrievalsh\&quot; id=\&quot;9lEqP-Ao-6W_A4MsMKyB-1\&quot;&gt;\n          &lt;mxCell parent=\&quot;1\&quot; style=\&quot;shape=card;whiteSpace=wrap;html=1;size=20;\&quot; vertex=\&quot;1\&quot;&gt;\n            &lt;mxGeometry height=\&quot;40\&quot; width=\&quot;70\&quot; x=\&quot;13\&quot; y=\&quot;60\&quot; as=\&quot;geometry\&quot; /&gt;\n          &lt;/mxCell&gt;\n        &lt;/UserObject&gt;\n        &lt;UserObject label=\&quot;retrieval.py\&quot; link=\&quot;#retrievalpy\&quot; id=\&quot;9lEqP-Ao-6W_A4MsMKyB-2\&quot;&gt;\n          &lt;mxCell parent=\&quot;1\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; vertex=\&quot;1\&quot;&gt;\n            &lt;mxGeometry height=\&quot;40\&quot; width=\&quot;80\&quot; x=\&quot;123\&quot; y=\&quot;60\&quot; as=\&quot;geometry\&quot; /&gt;\n          &lt;/mxCell&gt;\n        &lt;/UserObject&gt;\n        &lt;mxCell id=\&quot;9lEqP-Ao-6W_A4MsMKyB-4\&quot; parent=\&quot;1\&quot; style=\&quot;text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;\&quot; value=\&quot;unimol\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;30\&quot; width=\&quot;80\&quot; x=\&quot;123\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-17\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;tEi1e1O9SdKIs1-01QRP-26\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;\&quot; target=\&quot;tEi1e1O9SdKIs1-01QRP-10\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;Array as=\&quot;points\&quot;&gt;\n              &lt;mxPoint x=\&quot;497\&quot; y=\&quot;440\&quot; /&gt;\n              &lt;mxPoint x=\&quot;497\&quot; y=\&quot;160\&quot; /&gt;\n            &lt;/Array&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;9lEqP-Ao-6W_A4MsMKyB-5\&quot; parent=\&quot;1\&quot; style=\&quot;text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;\&quot; value=\&quot;&amp;lt;div&amp;gt;task = tasks.setup_task(args)&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;20\&quot; width=\&quot;190\&quot; x=\&quot;68\&quot; y=\&quot;110\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-3\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;9lEqP-Ao-6W_A4MsMKyB-6\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;\&quot; target=\&quot;tEi1e1O9SdKIs1-01QRP-1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;9lEqP-Ao-6W_A4MsMKyB-6\&quot; parent=\&quot;1\&quot; style=\&quot;rhombus;whiteSpace=wrap;html=1;\&quot; value=\&quot;task=drugclip\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;80\&quot; width=\&quot;100\&quot; x=\&quot;233\&quot; y=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;9lEqP-Ao-6W_A4MsMKyB-8\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;9lEqP-Ao-6W_A4MsMKyB-2\&quot; style=\&quot;endArrow=none;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;\&quot; target=\&quot;9lEqP-Ao-6W_A4MsMKyB-6\&quot; value=\&quot;\&quot;&gt;\n          &lt;mxGeometry height=\&quot;50\&quot; relative=\&quot;1\&quot; width=\&quot;50\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;mxPoint x=\&quot;233\&quot; y=\&quot;70\&quot; as=\&quot;sourcePoint\&quot; /&gt;\n            &lt;mxPoint x=\&quot;283\&quot; y=\&quot;20\&quot; as=\&quot;targetPoint\&quot; /&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-8\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;tEi1e1O9SdKIs1-01QRP-1\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;\&quot; target=\&quot;tEi1e1O9SdKIs1-01QRP-6\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-1\&quot; parent=\&quot;1\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;drugclip.py\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;40\&quot; width=\&quot;80\&quot; x=\&quot;363\&quot; y=\&quot;60\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-4\&quot; parent=\&quot;1\&quot; style=\&quot;text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;\&quot; value=\&quot;unimol/tasks\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;30\&quot; width=\&quot;80\&quot; x=\&quot;363\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-11\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;tEi1e1O9SdKIs1-01QRP-6\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.375;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;\&quot; target=\&quot;tEi1e1O9SdKIs1-01QRP-9\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-12\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;tEi1e1O9SdKIs1-01QRP-6\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.625;exitY=1;exitDx=0;exitDy=0;\&quot; target=\&quot;tEi1e1O9SdKIs1-01QRP-10\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-40\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;tEi1e1O9SdKIs1-01QRP-6\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;\&quot; target=\&quot;tEi1e1O9SdKIs1-01QRP-39\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-6\&quot; parent=\&quot;1\&quot; style=\&quot;shape=hexagon;perimeter=hexagonPerimeter2;whiteSpace=wrap;html=1;fixedSize=1;\&quot; value=\&quot;&amp;lt;font style=&amp;quot;font-size: 11px;&amp;quot;&amp;gt;DrugCLIP&amp;amp;nbsp;&amp;lt;/font&amp;gt;&amp;lt;div&amp;gt;&amp;lt;font style=&amp;quot;font-size: 11px;&amp;quot;&amp;gt;class&amp;lt;/font&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;40\&quot; width=\&quot;80\&quot; x=\&quot;479\&quot; y=\&quot;60\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-19\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;tEi1e1O9SdKIs1-01QRP-9\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;mxPoint x=\&quot;432.9999999999998\&quot; y=\&quot;290\&quot; as=\&quot;targetPoint\&quot; /&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-9\&quot; parent=\&quot;1\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;strokeWidth=2;\&quot; value=\&quot;build_model\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;40\&quot; width=\&quot;80\&quot; x=\&quot;393\&quot; y=\&quot;140\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-10\&quot; parent=\&quot;1\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;strokeWidth=2;\&quot; value=\&quot;retrieval_multi_folds\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;40\&quot; width=\&quot;120\&quot; x=\&quot;538\&quot; y=\&quot;140\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-20\&quot; parent=\&quot;1\&quot; style=\&quot;text;html=1;whiteSpace=wrap;align=center;verticalAlign=middle;rounded=0;fillColor=#FFFFFF;\&quot; value=\&quot;&amp;lt;font style=&amp;quot;font-size: 10px;&amp;quot;&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/font&amp;gt;&amp;lt;div&amp;gt;&amp;lt;font style=&amp;quot;font-size: 10px;&amp;quot;&amp;gt;model =&amp;amp;nbsp;&amp;lt;span style=&amp;quot;background-color: transparent;&amp;quot;&amp;gt;models.build_model(args, self)&amp;lt;/span&amp;gt;&amp;lt;/font&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;20\&quot; width=\&quot;184\&quot; x=\&quot;341\&quot; y=\&quot;190\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-21\&quot; parent=\&quot;1\&quot; style=\&quot;rhombus;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;font style=&amp;quot;font-size: 10px;&amp;quot;&amp;gt;arch = drugclip&amp;lt;/font&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;50\&quot; width=\&quot;80\&quot; x=\&quot;393\&quot; y=\&quot;220\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-22\&quot; parent=\&quot;1\&quot; style=\&quot;text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;\&quot; value=\&quot;unimol/models\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;20\&quot; width=\&quot;80\&quot; x=\&quot;341\&quot; y=\&quot;270\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-27\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;tEi1e1O9SdKIs1-01QRP-23\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;\&quot; target=\&quot;tEi1e1O9SdKIs1-01QRP-26\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-23\&quot; parent=\&quot;1\&quot; style=\&quot;shape=hexagon;perimeter=hexagonPerimeter2;whiteSpace=wrap;html=1;fixedSize=1;\&quot; value=\&quot;&amp;lt;font style=&amp;quot;font-size: 10px;&amp;quot;&amp;gt;&amp;amp;nbsp;BindingAffinityModel&amp;lt;/font&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;40\&quot; width=\&quot;114\&quot; x=\&quot;376\&quot; y=\&quot;350\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-25\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;tEi1e1O9SdKIs1-01QRP-24\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;\&quot; target=\&quot;tEi1e1O9SdKIs1-01QRP-23\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-24\&quot; parent=\&quot;1\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;drugclip.py\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;40\&quot; width=\&quot;80\&quot; x=\&quot;393\&quot; y=\&quot;290\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-26\&quot; parent=\&quot;1\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;strokeWidth=2;\&quot; value=\&quot;build_model\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;40\&quot; width=\&quot;80\&quot; x=\&quot;397\&quot; y=\&quot;420\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-28\&quot; parent=\&quot;1\&quot; style=\&quot;text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;\&quot; value=\&quot;&amp;lt;font style=&amp;quot;font-size: 10px;&amp;quot;&amp;gt;Initializes BindingAffinityModel&amp;lt;/font&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;20\&quot; width=\&quot;140\&quot; x=\&quot;291\&quot; y=\&quot;460\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-29\&quot; parent=\&quot;1\&quot; style=\&quot;text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;\&quot; value=\&quot;&amp;lt;font style=&amp;quot;font-size: 10px;&amp;quot;&amp;gt;Load state dict&amp;lt;/font&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;20\&quot; width=\&quot;80\&quot; x=\&quot;667\&quot; y=\&quot;160\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-31\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;tEi1e1O9SdKIs1-01QRP-30\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;mxPoint x=\&quot;697\&quot; y=\&quot;245.27586206896558\&quot; as=\&quot;targetPoint\&quot; /&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-34\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;tEi1e1O9SdKIs1-01QRP-30\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;\&quot; target=\&quot;tEi1e1O9SdKIs1-01QRP-39\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;mxPoint x=\&quot;598.1034482758621\&quot; y=\&quot;310\&quot; as=\&quot;targetPoint\&quot; /&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-30\&quot; parent=\&quot;1\&quot; style=\&quot;rhombus;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;font style=&amp;quot;font-size: 10px;&amp;quot;&amp;gt;use-cache&amp;lt;/font&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;50\&quot; width=\&quot;80\&quot; x=\&quot;558\&quot; y=\&quot;220\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-32\&quot; parent=\&quot;1\&quot; style=\&quot;text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;\&quot; value=\&quot;&amp;lt;span style=&amp;quot;background-color: rgb(255, 255, 255);&amp;quot;&amp;gt;&amp;lt;font style=&amp;quot;font-size: 10px;&amp;quot;&amp;gt;True&amp;lt;/font&amp;gt;&amp;lt;/span&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;30\&quot; width=\&quot;60\&quot; x=\&quot;634\&quot; y=\&quot;230\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-33\&quot; parent=\&quot;1\&quot; style=\&quot;text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;\&quot; value=\&quot;&amp;lt;font style=&amp;quot;font-size: 11px;&amp;quot;&amp;gt;Load embeddings&amp;lt;/font&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;30\&quot; width=\&quot;60\&quot; x=\&quot;707\&quot; y=\&quot;230\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-65\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;tEi1e1O9SdKIs1-01QRP-35\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;\&quot; target=\&quot;tEi1e1O9SdKIs1-01QRP-63\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;Array as=\&quot;points\&quot;&gt;\n              &lt;mxPoint x=\&quot;598\&quot; y=\&quot;300\&quot; /&gt;\n              &lt;mxPoint x=\&quot;721\&quot; y=\&quot;300\&quot; /&gt;\n            &lt;/Array&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-35\&quot; parent=\&quot;1\&quot; style=\&quot;text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;\&quot; value=\&quot;&amp;lt;span style=&amp;quot;background-color: rgb(255, 255, 255);&amp;quot;&amp;gt;&amp;lt;font style=&amp;quot;font-size: 10px;&amp;quot;&amp;gt;False&amp;lt;/font&amp;gt;&amp;lt;/span&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;30\&quot; width=\&quot;60\&quot; x=\&quot;568\&quot; y=\&quot;270\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-37\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;tEi1e1O9SdKIs1-01QRP-30\&quot; style=\&quot;endArrow=none;html=1;rounded=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;\&quot; target=\&quot;tEi1e1O9SdKIs1-01QRP-10\&quot; value=\&quot;\&quot;&gt;\n          &lt;mxGeometry height=\&quot;50\&quot; relative=\&quot;1\&quot; width=\&quot;50\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;mxPoint x=\&quot;553\&quot; y=\&quot;240\&quot; as=\&quot;sourcePoint\&quot; /&gt;\n            &lt;mxPoint x=\&quot;603\&quot; y=\&quot;190\&quot; as=\&quot;targetPoint\&quot; /&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-47\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;tEi1e1O9SdKIs1-01QRP-39\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;\&quot; target=\&quot;tEi1e1O9SdKIs1-01QRP-41\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-39\&quot; parent=\&quot;1\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;strokeWidth=2;strokeColor=light-dark(#50C363,#EDEDED);\&quot; value=\&quot;&amp;lt;font style=&amp;quot;font-size: 10px;&amp;quot;&amp;gt;load_mols_dataset&amp;lt;/font&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;30\&quot; width=\&quot;99\&quot; x=\&quot;548.5\&quot; y=\&quot;320\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-50\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;tEi1e1O9SdKIs1-01QRP-41\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;\&quot; target=\&quot;tEi1e1O9SdKIs1-01QRP-49\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;mxPoint x=\&quot;598\&quot; y=\&quot;396\&quot; as=\&quot;sourcePoint\&quot; /&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-41\&quot; parent=\&quot;1\&quot; style=\&quot;text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;\&quot; value=\&quot;&amp;lt;font style=&amp;quot;font-size: 10px;&amp;quot;&amp;gt;DataLoader&amp;lt;/font&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;20\&quot; width=\&quot;80\&quot; x=\&quot;558\&quot; y=\&quot;370\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-44\&quot; parent=\&quot;1\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;dashed=1;strokeColor=light-dark(#50c363, #ededed);perimeterSpacing=0;strokeWidth=2;\&quot; value=\&quot;&amp;lt;font style=&amp;quot;font-size: 10px;&amp;quot;&amp;gt;LMDBDataset (reads lmdb data)&amp;lt;/font&amp;gt;&amp;lt;div&amp;gt;&amp;lt;font style=&amp;quot;font-size: 10px;&amp;quot;&amp;gt;AffinityMolDataset (extracts relevant info)&amp;lt;/font&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;font style=&amp;quot;font-size: 10px;&amp;quot;&amp;gt;Processing steps (removings Hs,&amp;amp;nbsp;&amp;lt;/font&amp;gt;&amp;lt;span style=&amp;quot;font-size: 10px; background-color: transparent;&amp;quot;&amp;gt;&amp;lt;font style=&amp;quot;color: light-dark(rgb(83, 195, 195), rgb(255, 255, 255));&amp;quot;&amp;gt;crop pocket&amp;lt;/font&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;font-size: 10px; background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;,&amp;amp;nbsp;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;font-size: 10px; background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;normalize coords, tokenize atoms)&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;font style=&amp;quot;font-size: 10px;&amp;quot;&amp;gt;Edge type ID&amp;lt;/font&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;font style=&amp;quot;font-size: 10px;&amp;quot;&amp;gt;Atoms pairs dist.&amp;lt;/font&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;170\&quot; width=\&quot;130\&quot; x=\&quot;33\&quot; y=\&quot;180\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-45\&quot; parent=\&quot;1\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;fillColor=none;dashed=1;\&quot; value=\&quot;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;170\&quot; width=\&quot;120\&quot; x=\&quot;540\&quot; y=\&quot;406\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-55\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;tEi1e1O9SdKIs1-01QRP-49\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;\&quot; target=\&quot;tEi1e1O9SdKIs1-01QRP-52\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-49\&quot; parent=\&quot;1\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;font style=&amp;quot;font-size: 10px;&amp;quot;&amp;gt;Prepare input&amp;lt;/font&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;30\&quot; width=\&quot;100\&quot; x=\&quot;548\&quot; y=\&quot;413\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-56\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;tEi1e1O9SdKIs1-01QRP-52\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;\&quot; target=\&quot;tEi1e1O9SdKIs1-01QRP-53\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-52\&quot; parent=\&quot;1\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;font style=&amp;quot;font-size: 10px;&amp;quot;&amp;gt;Distance + edge fusion&amp;lt;/font&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;30\&quot; width=\&quot;100\&quot; x=\&quot;548.5\&quot; y=\&quot;461\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-57\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;tEi1e1O9SdKIs1-01QRP-53\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;\&quot; target=\&quot;tEi1e1O9SdKIs1-01QRP-54\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-53\&quot; parent=\&quot;1\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;font style=&amp;quot;font-size: 10px;&amp;quot;&amp;gt;Transformer encoder&amp;lt;/font&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;20\&quot; width=\&quot;100\&quot; x=\&quot;549\&quot; y=\&quot;506\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-61\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;tEi1e1O9SdKIs1-01QRP-54\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;\&quot; target=\&quot;tEi1e1O9SdKIs1-01QRP-60\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-85\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;tEi1e1O9SdKIs1-01QRP-54\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=0.25;entryY=0;entryDx=0;entryDy=0;\&quot; target=\&quot;tEi1e1O9SdKIs1-01QRP-82\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;Array as=\&quot;points\&quot;&gt;\n              &lt;mxPoint x=\&quot;624\&quot; y=\&quot;586\&quot; /&gt;\n              &lt;mxPoint x=\&quot;715\&quot; y=\&quot;586\&quot; /&gt;\n            &lt;/Array&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-54\&quot; parent=\&quot;1\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;font style=&amp;quot;font-size: 10px;&amp;quot;&amp;gt;Prepare output&amp;lt;/font&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;20\&quot; width=\&quot;100\&quot; x=\&quot;548.5\&quot; y=\&quot;546\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-59\&quot; parent=\&quot;1\&quot; style=\&quot;text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;\&quot; value=\&quot;&amp;lt;font style=&amp;quot;font-size: 11px; color: rgb(204, 0, 0);&amp;quot;&amp;gt;Batch loop&amp;lt;/font&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;30\&quot; width=\&quot;60\&quot; x=\&quot;606\&quot; y=\&quot;383\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-60\&quot; parent=\&quot;1\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;span style=&amp;quot;font-size: 10px;&amp;quot;&amp;gt;Save embeddings&amp;lt;/span&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;20\&quot; width=\&quot;100\&quot; x=\&quot;549\&quot; y=\&quot;601\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-67\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;tEi1e1O9SdKIs1-01QRP-63\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;\&quot; target=\&quot;tEi1e1O9SdKIs1-01QRP-66\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-63\&quot; parent=\&quot;1\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;strokeWidth=2;strokeColor=light-dark(#53C3C3,#EDEDED);\&quot; value=\&quot;&amp;lt;font style=&amp;quot;font-size: 10px;&amp;quot;&amp;gt;load_pockets_dataset&amp;lt;/font&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;30\&quot; width=\&quot;104\&quot; x=\&quot;669\&quot; y=\&quot;320\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-66\&quot; parent=\&quot;1\&quot; style=\&quot;text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;\&quot; value=\&quot;&amp;lt;font style=&amp;quot;font-size: 10px;&amp;quot;&amp;gt;DataLoader&amp;lt;/font&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;20\&quot; width=\&quot;80\&quot; x=\&quot;687\&quot; y=\&quot;370\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-70\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;\&quot; target=\&quot;tEi1e1O9SdKIs1-01QRP-73\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;mxPoint x=\&quot;738\&quot; y=\&quot;390\&quot; as=\&quot;sourcePoint\&quot; /&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-71\&quot; parent=\&quot;1\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;fillColor=none;dashed=1;\&quot; value=\&quot;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;170\&quot; width=\&quot;120\&quot; x=\&quot;680\&quot; y=\&quot;406\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-72\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;tEi1e1O9SdKIs1-01QRP-73\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;\&quot; target=\&quot;tEi1e1O9SdKIs1-01QRP-75\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-73\&quot; parent=\&quot;1\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;font style=&amp;quot;font-size: 10px;&amp;quot;&amp;gt;Prepare input&amp;lt;/font&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;30\&quot; width=\&quot;100\&quot; x=\&quot;688\&quot; y=\&quot;413\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-74\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;tEi1e1O9SdKIs1-01QRP-75\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;\&quot; target=\&quot;tEi1e1O9SdKIs1-01QRP-77\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-75\&quot; parent=\&quot;1\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;font style=&amp;quot;font-size: 10px;&amp;quot;&amp;gt;Distance + edge fusion&amp;lt;/font&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;30\&quot; width=\&quot;100\&quot; x=\&quot;688.5\&quot; y=\&quot;461\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-76\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;tEi1e1O9SdKIs1-01QRP-77\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;\&quot; target=\&quot;tEi1e1O9SdKIs1-01QRP-78\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-77\&quot; parent=\&quot;1\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;font style=&amp;quot;font-size: 10px;&amp;quot;&amp;gt;Transformer encoder&amp;lt;/font&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;20\&quot; width=\&quot;100\&quot; x=\&quot;689\&quot; y=\&quot;506\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-84\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;tEi1e1O9SdKIs1-01QRP-78\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;mxPoint x=\&quot;738.6666666666667\&quot; y=\&quot;600\&quot; as=\&quot;targetPoint\&quot; /&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-78\&quot; parent=\&quot;1\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;font style=&amp;quot;font-size: 10px;&amp;quot;&amp;gt;Prepare output&amp;lt;/font&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;20\&quot; width=\&quot;100\&quot; x=\&quot;688.5\&quot; y=\&quot;546\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-79\&quot; parent=\&quot;1\&quot; style=\&quot;text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;\&quot; value=\&quot;&amp;lt;font style=&amp;quot;font-size: 11px; color: rgb(204, 0, 0);&amp;quot;&amp;gt;Batch loop&amp;lt;/font&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;30\&quot; width=\&quot;60\&quot; x=\&quot;745\&quot; y=\&quot;383\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-80\&quot; parent=\&quot;1\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;fillColor=none;dashed=1;\&quot; value=\&quot;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;420\&quot; width=\&quot;281.5\&quot; x=\&quot;530\&quot; y=\&quot;215\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-81\&quot; parent=\&quot;1\&quot; style=\&quot;text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;\&quot; value=\&quot;&amp;lt;font style=&amp;quot;font-size: 11px; color: rgb(204, 0, 0);&amp;quot;&amp;gt;Number of folds loop&amp;lt;/font&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;20\&quot; width=\&quot;118\&quot; x=\&quot;693.5\&quot; y=\&quot;195\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-93\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;tEi1e1O9SdKIs1-01QRP-82\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;\&quot; target=\&quot;tEi1e1O9SdKIs1-01QRP-91\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-82\&quot; parent=\&quot;1\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;span style=&amp;quot;font-size: 10px;&amp;quot;&amp;gt;Matrix multiplication&amp;lt;/span&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;20\&quot; width=\&quot;100\&quot; x=\&quot;690\&quot; y=\&quot;601\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-89\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;tEi1e1O9SdKIs1-01QRP-86\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;\&quot; target=\&quot;tEi1e1O9SdKIs1-01QRP-87\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-86\&quot; parent=\&quot;1\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;span style=&amp;quot;font-size: 10px;&amp;quot;&amp;gt;Multi-folds mean&amp;lt;/span&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;20\&quot; width=\&quot;85\&quot; x=\&quot;509.5\&quot; y=\&quot;670\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-90\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;tEi1e1O9SdKIs1-01QRP-87\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;\&quot; target=\&quot;tEi1e1O9SdKIs1-01QRP-88\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-87\&quot; parent=\&quot;1\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;span style=&amp;quot;font-size: 10px;&amp;quot;&amp;gt;Adjusted robust z-score&amp;lt;/span&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;20\&quot; width=\&quot;110\&quot; x=\&quot;612.5\&quot; y=\&quot;670\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-88\&quot; parent=\&quot;1\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;span style=&amp;quot;font-size: 10px;&amp;quot;&amp;gt;Max score&amp;lt;/span&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;20\&quot; width=\&quot;70\&quot; x=\&quot;741.5\&quot; y=\&quot;670\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tEi1e1O9SdKIs1-01QRP-91\&quot; parent=\&quot;1\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;fillColor=none;dashed=1;\&quot; value=\&quot;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;30\&quot; width=\&quot;320\&quot; x=\&quot;500\&quot; y=\&quot;665\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n      &lt;/root&gt;\n    &lt;/mxGraphModel&gt;\n  &lt;/diagram&gt;\n&lt;/mxfile&gt;\n&quot;}">

</div>
<script type="text/javascript" src="https://viewer.diagrams.net/js/viewer-static.min.js"></script>
<h1 id="scripts">Scripts</h1>
<h2 id="retrieval.sh">retrieval.sh</h2>
<p>Bash script for virtual screening with DrugCLIP: 1. Calls <a
href="#retrievalpy"><code>retrieval.py</code></a> to run the workflow.
2. Accepts command-line arguments (CLI) for customization. 3. Sets the
task to drugclip. 4. If –use-cache=true, it loads pre-computed molecular
embeddings. 5. If –use-cache=false, it generates new molecular
embeddings from scratch. 6. When –use-cache=false, an LMDB file
containing molecule information must be provided via the –MOL_PATH
argument.</p>
<h2 id="retrievalpy">retrieval.py</h2>
<p>Responsibilities: 1. Parse command-line arguments (CLI). 2. Set up
the task using UniCore.<br />
- If <code>task=drugclip</code>, <code>unimol/tasks/drugclip.py</code>
is invoked, and the <a
href="#drugclip-class"><code>DrugCLIP class</code></a> is initialized.
3. Build the model corresponding to the specified architecture using the
<a href="#build_model"><code>build_model</code></a> method from
<strong>DrugCLIP class</strong> 4. Call
<code>retrieval_multi_folds</code> to execute the virtual screening
pipeline.</p>
<h1 id="classes">Classes</h1>
<h2 id="drugclipclass">DrugCLIP class</h2>
<p>Class for <code>task="drugclip"</code>.</p>
<h3 id="important-methods">Important Methods</h3>
<h4 id="build_model"><code>build_model()</code></h4>
<ul>
<li>Calls <code>unicore.models.build_model</code>.</li>
<li>If <code>arch="drugclip"</code>,
<code>unimol/models/drugclip.py</code> is invoked.<br />
</li>
<li>The <a
href="#bindingaffinitymodel"><code>BindingAffinityModel</code></a> class
is initialized, and its <code>build_model</code> method is called.</li>
</ul>
<h4 id="retrieval_multi_folds"><code>retrieval_multi_folds</code></h4>
<p>This function orchestrates the multi-fold virtual screening process
and manages caching of molecular and pocket embeddings. By default, it
loops over 6 folds.</p>
<ol type="1">
<li><strong>Load checkpoint weights:</strong>
<ul>
<li>For each fold, the saved checkpoint weights are loaded into the
pre-initialized model.</li>
</ul></li>
<li><strong>Load or compute molecular embeddings:</strong>
<ul>
<li>If <code>use-cache=True</code>, precomputed molecular embeddings are
loaded for the current fold.<br />
</li>
<li>If <code>use-cache=False</code>:
<ol type="1">
<li><a href="#load_mols_dataset"><code>load_mols_dataset</code></a>
reads the LMDB file containing molecular data.<br />
</li>
<li>A PyTorch <code>DataLoader</code> is created.<br />
</li>
<li>A batch loop is executed:
<ol type="1">
<li>Prepare the model input: extract distances, edge types, and tokens
for each sample; embed tokens with
<code>model.mol_model.embed_tokens</code>.<br />
</li>
<li>Fuse and project distance and edge information for graph
attention.<br />
</li>
<li>Apply <code>model.mol_model.encoder</code> to compute molecular
representations.<br />
</li>
<li>Extract the <code>[CLS]</code> token embedding, project to
lower-dimensional space using <code>mol_project</code>, and normalize to
unit length.<br />
</li>
<li>Append embeddings to a list <code>mol_reps</code>. After all
batches, convert <code>mol_reps</code> into a matrix of shape
<code>(num_samples x embedding_size)</code>.<br />
</li>
<li>Save the molecular embeddings to cache.</li>
</ol></li>
</ol></li>
</ul></li>
<li><strong>Load or compute pocket embeddings:</strong>
<ol type="1">
<li><code>load_pockets_dataset</code> reads the LMDB file containing
pocket data.<br />
</li>
<li>A PyTorch <code>DataLoader</code> is created.<br />
</li>
<li>A batch loop is executed:
<ol type="1">
<li>Prepare the model input: extract distances, edge types, and tokens;
embed tokens using <code>model.pocket_model.embed_tokens</code>.<br />
</li>
<li>Fuse and project distance and edge information for graph
attention.<br />
</li>
<li>Apply <code>model.pocket_model.encoder</code> to compute pocket
representations.<br />
</li>
<li>Extract the <code>[CLS]</code> token embedding, project to
lower-dimensional space using <code>pocket_project</code>, and normalize
to unit length.<br />
</li>
<li>Append embeddings to a list <code>pocket_reps</code>. After all
batches, convert <code>pocket_reps</code> into a matrix of shape
<code>(num_samples x embedding_size)</code>.</li>
</ol></li>
</ol></li>
<li><strong>Compute similarity matrices:</strong>
<ul>
<li>Multiply the <code>pocket_reps</code> matrix with the transpose of
the <code>mol_reps</code> matrix to compute cosine similarities.</li>
</ul></li>
<li><strong>Aggregate results across folds:</strong>
<ul>
<li>Average the similarity matrices from all folds.<br />
</li>
<li>Apply an adjusted robust z-score normalization.<br />
</li>
<li>For each pocket, select the maximum score across molecules (assuming
different pockets correspond to different conformations of the same
pocket).</li>
</ul></li>
<li><strong>Save results:</strong>
<ul>
<li>Save the final scores and corresponding SMILES strings to a
<code>.txt</code> file.</li>
</ul></li>
</ol>
<h4 id="load_mols_dataset">load_mols_dataset()</h4>
<ol type="1">
<li>Initializes the <code>LMDBDataset</code> class, which reads LMDB
files and returns all data for a single molecule when accessed by index
(<code>dataset[idx]</code>).</li>
<li>Wraps it in the <code>AffinityMolDataset</code> class, which
prepares and organizes the molecule data into a structured dictionary
format.</li>
<li>Applies the <code>RemoveHydrogenDataset</code> class to remove
hydrogen atoms from the molecule representation.</li>
<li>Uses the <code>NormalizeDataset</code> class to center the 3D
coordinates of the atoms.</li>
<li>Extracts atom information, tokenizes it, and prepends
(<code>BOS</code>) and appends (<code>EOS</code>) special tokens.</li>
<li>Generates unique identifiers for each edge between atoms using the
<code>EdgeTypeDataset</code> class.</li>
<li>Computes pairwise distances between atoms using the
<code>DistanceDataset</code> class.</li>
<li>Combines all the processed information into a single
<code>NestedDictionaryDataset</code> object, ready for model input.</li>
</ol>
<h4 id="load_pockets_dataset"><code>load_pockets_dataset()</code></h4>
<p>Follows the same processing steps as
<code>load_mols_dataset()</code>, but after step 3 it <strong>crops the
pocket sequence</strong> if it contains more than a specified maximum
number of atoms (default: 256).</p>
<h2 id="bindingaffinitymodel">BindingAffinityModel</h2>
<p>This class implements the DrugCLIP architecture for binding affinity
prediction.</p>
<ul>
<li>Uses the defined <code>drugclip_architecture</code> to set up the
model configuration.<br />
</li>
<li>Initializes:
<ul>
<li>A <strong>molecular model</strong> using the Uni-Mol architecture
(<code>UniMolModel</code> class).<br />
</li>
<li>A <strong>pocket model</strong> using the Uni-Mol architecture
(<code>UniMolModel</code> class).<br />
</li>
</ul></li>
<li>The <code>build_model</code> method creates and returns an instance
of the model.</li>
</ul>
<h1 id="concepts">Concepts</h1>
<h2 id="edge-types">Edge Types</h2>
<p>Unique IDs representing atom-type pairs</p>
<h2 id="gaussian-basis-features">Gaussian Basis Features</h2>
<p>Encodes geometry into attention bias</p>
<h2 id="cosine-similarity-retrieval">Cosine Similarity Retrieval</h2>
<p>Unit-normalized embeddings → dot product</p>
<h1 id="applied-changes">Applied changes</h1>
<ul>
<li><p><code>retrieval.sh</code> now calls
<code>run_retrieval.py</code>, a safe wrapper around
<code>retrieval.py</code> for <strong>PyTorch ≥ 2.6</strong>.<br />
This wrapper ensures that required globals are registered for unpickling
checkpoints generated with <strong>PyTorch &lt; 2.6</strong>, and
forwards all command-line arguments to <code>retrieval.py</code>.
<strong>Explanation:</strong><br />
Model checkpoints were created with PyTorch &lt; 2.6. In PyTorch ≥ 2.6,
<code>torch.load()</code> defaults to <code>weights_only=True</code>,
which restricts deserialization to tensor objects only. As a result,
loading checkpoints containing non-tensor objects (e.g.,
<code>argparse.Namespace</code>) raises an error.<br />
<code>run_retrieval.py</code> restores compatibility by explicitly
handling this behavior.</p></li>
<li><p>Handling of the <code>--use-cache</code> CLI argument in
<code>retrieval.py</code> has been fixed.<br />
Previously, <code>use-cache</code> was parsed as a string, meaning both
<code>"True"</code> and <code>"False"</code> evaluated as truthy
values.<br />
It is now converted to a proper boolean via:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>args.use_cache.lower() <span class="op">==</span> <span class="st">&quot;true&quot;</span></span></code></pre></div></li>
<li><p>A memory-optimized implementation of
<code>retrieval_multi_folds</code> has been introduced in a new file:
<code>unimol/tasks/drugclip_modified.py</code>. This modified task can
be used by setting <code>task=drugclip-new</code> in the
<code>retrieval.sh</code> script. The changes improve scalability when
screening millions of molecules.</p></li>
</ul>
<p><strong>Key modifications:</strong> - Pocket embeddings are computed
first and stored in <code>pocket_reps</code>. - Molecule embeddings are
processed batch-wise. Instead of storing all molecular embeddings in a
large matrix of shape <strong>(number_of_molecules ×
embedding_dim)</strong>, similarity scores between pocket and molecule
embeddings are computed on-the-fly for each batch. - Similarity scores
are accumulated in a dictionary keyed by molecule SMILES. This ensures
correct alignment between molecules and their scores across folds
without requiring full similarity matrices in memory. - The
<code>use-cache=True</code> branch has been adapted to follow the same
accumulation strategy, ensuring consistent behavior between cached and
non-cached execution modes. - Similarity scores are summed across folds
and averaged by dividing by the number of folds. - The adjusted robust
z-score normalization across pocket conformations and the subsequent max
pooling step have been removed. This change: - avoids implicit
assumptions that all input pockets belong to the same target, - allows
users to provide unrelated proteins/pockets as input, - and returns raw
cosine similarity scores, leaving any aggregation or normalization
strategy to downstream analysis.</p>
<p>Returned scores correspond to cosine similarity between unit-vector
normalized pocket and molecule embeddings. New thresholds to define
affinity need to be defined.</p>
